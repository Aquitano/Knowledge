---
import Section from '../components/common/Section.astro';
import type { ArticleFrontmatter } from '../lib/types';
import { getShortDescription, processArticleDate, generateSourceUrl } from '../lib/utils';
import { GLOBAL } from '../lib/variables';
import type { MarkdownLayoutProps } from 'astro';
import Prose from '../components/Prose.astro';
import Layout from './Layout.astro';

type Props = MarkdownLayoutProps<ArticleFrontmatter>;

const { frontmatter } = Astro.props;
const shortDescription = getShortDescription(frontmatter.description);
const articleDate = processArticleDate(frontmatter.timestamp);
const sourceUrl = generateSourceUrl(frontmatter.filename, 'blog');
---

<Layout>
    <Fragment slot="head">
        <title>{frontmatter.title} • {GLOBAL.username}</title>
        <meta name="description" content={frontmatter.description} />
        <meta property="og:title" content={`${frontmatter.title} • ${GLOBAL.username}`} />
        <meta property="og:description" content={shortDescription} />
        <meta property="og:image" content={`${GLOBAL.rootUrl}/${GLOBAL.profileImage}`} />
        <meta property="og:url" content={sourceUrl} />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={`${frontmatter.title} • {GLOBAL.username}`} />
        <meta name="twitter:description" content={shortDescription} />
        <meta name="twitter:image" content={`${GLOBAL.rootUrl}/${GLOBAL.profileImage}`} />
        <meta http-equiv="content-language" content="en" />
        <meta name="language" content="English" />
        <link rel="canonical" href={sourceUrl} />
    </Fragment>
    <Section class="pt-8">
        <div class="mb-2">
            <a href="/" class="text-primary flex items-center gap-1 hover:underline">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to all articles
            </a>
        </div>

        <div class="mt-8 mb-8 flex flex-col gap-4">
            <h1 class="font-display text-3xl leading-normal sm:text-4xl sm:leading-normal">
                {frontmatter.title}
            </h1>
            <div class="flex items-center justify-between">
                <span class="text-neutral-600 dark:text-neutral-300">{articleDate}</span>
                <span class="text-neutral-500 dark:text-neutral-400">{frontmatter.time} min read</span>
            </div>

            {
                frontmatter.tags && frontmatter.tags.length > 0 && (
                    <div class="flex flex-wrap gap-2">
                        {frontmatter.tags.map((tag) => (
                            <a
                                href={`/tags/${tag.toLowerCase()}`}
                                class="hover:bg-primary/20 hover:text-primary dark:hover:bg-primary/20 dark:hover:text-primary rounded-md bg-neutral-100 px-2 py-1 text-xs transition-colors dark:bg-neutral-800"
                            >
                                {tag}
                            </a>
                        ))}
                    </div>
                )
            }
        </div>

        <Prose>
            <slot />
        </Prose>

        <div class="mt-12 border-t border-neutral-200 pt-8 dark:border-neutral-800">
            <p class="text-neutral-600 italic dark:text-neutral-300">
                Written by {GLOBAL.username}
            </p>
            <div class="mt-6 flex gap-4">
                <a href="/blog" class="text-primary hover:underline">← Back to articles</a>
                <a href="/" class="text-primary hover:underline">Home</a>
            </div>
        </div>
    </Section>
</Layout>
